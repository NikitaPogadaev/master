Будем хранить массив указателей на элементы как на узлы их деревьев (изначально на n элементов за n построим n древьев с одним элементом).
Затем будем строить деревья-поиска по запросам (мерджим за O(log(n))). Если идет запрос на поиск наименьшего большего элемента x в дереве,
где содержится элемент с индексом i, по i находим узел, из узла поднимаемся в  корень не более чем за высоту дерева, то есть не более чем
за log(n), поднявшись в корень делаем поиск элеменита x за O(log(n)). В итоге создаем за n, все операции будут за O(log(n)), то есть 
весь алгоритм работает за O(n+qlog(n)).